<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>æˆ‘å€‘å®¶çš„ç¾å‘³é¦¬æˆ²åœ˜ ğŸª</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@500;700;900&display=swap');

    :root {
      --bg-dark: #2a2236;
      --primary: #e88e9e;
      --secondary: #a496c4;
      --accent: #f2c94c;
      --text: #4a3b52;
      --card-bg: rgba(255, 255, 255, 0.96);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Zen Maru Gothic', sans-serif;
      background-color: var(--bg-dark);
      /* èƒŒæ™¯åœ– */
      background-image: url('image_cf8619.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      margin: 0; height: 100vh;
      display: flex; justify-content: center; align-items: center;
      overflow: hidden;
    }

    body::after {
      content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(42, 34, 54, 0.35);
      z-index: -1;
    }

    .app-frame {
      width: 100%; max-width: 480px; height: 100%;
      background: var(--card-bg);
      display: flex; flex-direction: column;
      position: relative;
      box-shadow: 0 0 60px rgba(0,0,0,0.6);
      overflow: hidden;
      backdrop-filter: blur(10px);
    }

    .circus-top {
      height: 18px;
      background: repeating-linear-gradient(90deg, var(--primary), var(--primary) 20px, #fff 20px, #fff 40px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 10;
    }

    .nav {
      padding: 12px; text-align: center;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .nav h1 {
      margin: 0; font-size: 1.2rem; color: var(--text);
      font-weight: 900; letter-spacing: 1px;
    }

    .stage {
      flex: 1; overflow-y: auto; padding: 20px; scroll-behavior: smooth;
      position: relative;
    }

    /* åœ˜é•·é ­åƒ */
    .host-area {
      display: flex; gap: 15px; margin-bottom: 25px; align-items: flex-end;
      animation: float 3s ease-in-out infinite;
    }
    .host-avatar {
      width: 90px; height: 90px;
      border-radius: 50%; border: 4px solid #fff;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      background-size: cover; background-position: center;
      background-color: #fff;
      background-image: url('image_cf8613.jpg'); 
    }
    .bubble {
      flex: 1; background: #fff; padding: 16px;
      border-radius: 20px 20px 20px 0;
      font-size: 0.95rem; line-height: 1.6; color: var(--text);
      box-shadow: 4px 4px 0px rgba(164, 150, 196, 0.3);
      border: 2px solid var(--secondary);
      position: relative;
    }
    .bubble::after {
      content: ''; position: absolute; bottom: 0; left: -10px;
      width: 0; height: 0;
      border-right: 10px solid var(--secondary); border-top: 10px solid transparent;
    }

    @keyframes float { 0%, 100% {transform: translateY(0);} 50% {transform: translateY(-6px);} }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    
    .card-btn {
      background: #fff; border: 2px solid #eee;
      border-radius: 18px; padding: 15px; text-align: center;
      cursor: pointer; transition: 0.2s; position: relative;
    }
    .card-btn:active { transform: scale(0.96); }
    .card-btn.selected {
      border-color: var(--primary); background: #fff0f5;
      box-shadow: 0 0 0 2px var(--primary) inset;
    }
    .c-icon { font-size: 1.8rem; display: block; margin-bottom: 5px; }
    .c-title { font-weight: 700; display: block; color: var(--text); }
    .c-sub { font-size: 0.75rem; color: #888; display: block; margin-top: 2px; }

    .category-deco { text-align: center; margin: 20px 0 10px; }
    .deco-img {
      height: 80px; border-radius: 12px; 
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      border: 3px solid #fff;
      transition: transform 0.3s;
      background-color: #eee;
      object-fit: cover;
    }
    .deco-img:hover { transform: rotate(-5deg) scale(1.05); }
    .deco-label {
      font-size: 0.85rem; font-weight: bold; color: var(--secondary);
      margin-top: 5px; letter-spacing: 1px;
    }

    .tag-cloud { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
    .tag {
      background: #fff; border: 1px solid var(--secondary);
      color: var(--text); padding: 8px 16px; border-radius: 25px;
      font-size: 0.9rem; cursor: pointer; transition: 0.2s;
    }
    .tag.active {
      background: var(--primary); color: #fff; border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(232, 142, 158, 0.4); transform: translateY(-2px);
    }

    .btn-main {
      width: 100%; padding: 16px; border: none; border-radius: 50px;
      background: linear-gradient(135deg, var(--primary), #dfa6b6);
      color: #fff; font-size: 1.1rem; font-weight: 900; letter-spacing: 1px;
      cursor: pointer; margin-top: 25px;
      box-shadow: 0 6px 20px rgba(232, 142, 158, 0.5);
      display: flex; align-items: center; justify-content: center; gap: 8px;
      transition: 0.2s;
    }
    .btn-main:active { transform: scale(0.98); }
    .btn-outline {
      background: #fff; color: var(--text); border: 2px solid #eee; box-shadow: none;
    }

    .ticket {
      background: #fff; padding: 16px; border-radius: 16px;
      margin-bottom: 12px; position: relative;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      border: 1px solid #f0f0f0;
      border-left: 6px solid var(--secondary);
      animation: popUp 0.5s ease;
    }
    @keyframes popUp { from{opacity:0; transform:translateY(15px);} to{opacity:1; transform:translateY(0);} }

    .shop-n { font-size: 1.15rem; font-weight: 900; color: var(--text); text-decoration: none; display: block; border-bottom: 2px dotted var(--accent); padding-bottom: 4px;}
    .shop-n:hover { color: var(--primary); }
    
    .meta-row { display: flex; gap: 6px; align-items: center; margin-top: 8px; flex-wrap: wrap; }
    .badge { padding: 2px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: bold; }
    .b-local { background: #eefcf6; color: #00b894; }
    .b-chain { background: #f5f5f5; color: #888; }
    .b-hot { background: #fff4e6; color: #e67e22; }
    
    .dist-info { 
      margin-top: 10px; padding-top: 8px; border-top: 1px dashed #eee;
      display: flex; gap: 15px; font-size: 0.85rem; color: #666; font-weight: 600;
    }

    .status-lamp {
      position: absolute; top: 16px; right: 16px;
      font-size: 0.75rem; font-weight: bold; padding: 4px 10px; border-radius: 20px;
    }
    .lamp-on { background: #e3fcef; color: #00b894; }
    .lamp-wait { background: #fff9db; color: #f1c40f; border:1px solid #f1c40f; }
    .lamp-off { background: #fff5f5; color: #ff7675; }

    /* æ²’çµæœçš„å¡ç‰‡æ¨£å¼ */
    .empty-card {
      background: #fff; border-radius: 20px;
      padding: 30px 20px; text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      border: 2px solid var(--primary);
      animation: popUp 0.5s ease;
    }

    .scene { display: none; }
    .scene.active { display: block; animation: fadeIn 0.4s; }
    @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }

  </style>
</head>
<body>

<div class="app-frame">
  <div class="circus-top"></div>
  <div class="nav">
    <h1>ğŸª æˆ‘å€‘å®¶çš„ç¾å‘³é¦¬æˆ²åœ˜</h1>
  </div>

  <div class="stage">
    
    <div id="scene1" class="scene active">
      <div class="host-area">
        <div class="host-avatar" id="av1"></div>
        <div class="bubble">
          æ­¡è¿å›å®¶ï¼æˆ‘æ˜¯åœ˜é•· Shappo ğŸ©<br>
          å·²ç¶“å¹«æ‚¨éš±è—è¡Œè¹¤å›‰ï¼ˆGoogle æ‰¾ä¸åˆ°é€™è£¡ï¼‰âœ¨<br>
          ä»Šå¤©æƒ³åƒå“ªä¸€é¤ï¼Ÿ
        </div>
      </div>
      
      <div class="grid-2">
        <div class="card-btn" onclick="setMeal('b')">
          <span class="c-icon">ğŸ¥ª</span><span class="c-title">æ—©é¤ / æ—©åˆé¤</span>
          <span class="c-sub">é£¯ç³°ã€ç‡’é¤…ã€åå¸</span>
        </div>
        <div class="card-btn" onclick="setMeal('l')">
          <span class="c-icon">ğŸ±</span><span class="c-title">åˆé¤æ™‚æ®µ</span>
          <span class="c-sub">ä¾¿ç•¶ã€æ°´é¤ƒã€éºµé£Ÿ</span>
        </div>
        <div class="card-btn" onclick="setMeal('d')">
          <span class="c-icon">ğŸ²</span><span class="c-title">æ™šé¤èšæœƒ</span>
          <span class="c-sub">ç«é‹ã€é¤å»³ã€ç†±ç‚’</span>
        </div>
        <div class="card-btn" onclick="setMeal('n')">
          <span class="c-icon">ğŸŒ™</span><span class="c-title">æ·±å¤œå®µå¤œ</span>
          <span class="c-sub">ç‚¸ç‰©ã€æ»·å‘³ã€è±†æ¼¿</span>
        </div>
      </div>
    </div>

    <div id="scene2" class="scene">
      <div class="host-area">
        <div class="host-avatar" id="av2"></div>
        <div class="bubble">å¥½çš„ï¼é‚£é€™é¤çš„é ç®—å¤§æ¦‚æ˜¯ï¼ŸğŸ’°</div>
      </div>
      <div class="grid-2">
        <div class="card-btn" onclick="setPrice(1)">
          <span class="c-icon">ğŸ’µ</span><span class="c-title">å¹³åƒ¹åƒé£½ ($)</span>
        </div>
        <div class="card-btn" onclick="setPrice(2)">
          <span class="c-icon">âœ¨</span><span class="c-title">åƒå¥½ä¸€é» ($$)</span>
        </div>
        <div class="card-btn" style="grid-column: span 2" onclick="setPrice(0)">
          <span class="c-icon">ğŸš€</span><span class="c-title">éƒ½å¯ä»¥ï¼</span>
        </div>
      </div>
      <button class="btn-main btn-outline" onclick="go(1)">â†© ä¸Šä¸€æ­¥</button>
    </div>

    <div id="scene3" class="scene">
      <div class="host-area">
        <div class="host-avatar" id="av3"></div>
        <div class="bubble">
          æœ€å¾Œï¼æƒ³åƒä»€éº¼é¡å‹ï¼Ÿ<br>
          æ­¡æ­¡é›è‚‰é£¯ã€Mr.38ã€çš‡ä½³è”¥æ²¹é¤…éƒ½åœ¨è£¡é¢å–”ï¼âœ¨
        </div>
      </div>

      <div class="category-deco">
        <img src="image_cf8695.jpg" class="deco-img" alt="é»‘è²“">
        <div class="deco-label">â˜… å··å¼„èˆ‡æ—¥å¸¸ â˜…</div>
      </div>
      <div class="tag-cloud">
        <div class="tag" onclick="tog(this, 'å°åƒ')">ğŸ¥¢ åœ¨åœ°å°åƒ</div>
        <div class="tag" onclick="tog(this, 'éºµé£Ÿ')">ğŸœ éºµé£Ÿæ¹¯åŒ…</div>
        <div class="tag" onclick="tog(this, 'é£¯é¡')">ğŸš é£¯é¡ä¾¿ç•¶</div>
        <div class="tag" onclick="tog(this, 'æ—©é¤')">ğŸ¥ª å‚³çµ±æ—©é¤</div>
      </div>

      <div class="category-deco" style="margin-top:25px;">
        <img src="image_cf893a.jpg" class="deco-img" alt="è–ä»£">
        <div class="deco-label">â˜… ç•°åœ‹èˆ‡èšé¤ â˜…</div>
      </div>
      <div class="tag-cloud">
        <div class="tag" onclick="tog(this, 'ç«é‹')">ğŸ² è³ªæ„Ÿé‹ç‰©</div>
        <div class="tag" onclick="tog(this, 'æ—¥å¼')">ğŸ‡¯ğŸ‡µ æ—¥å¼æ–™ç†</div>
        <div class="tag" onclick="tog(this, 'éŸ“å¼')">ğŸ‡°ğŸ‡· éŸ“å¼æ–™ç†</div>
        <div class="tag" onclick="tog(this, 'æ±å—äº')">ğŸ‡»ğŸ‡³ æ³°è¶Šæ–™ç†</div>
        <div class="tag" onclick="tog(this, 'è¥¿å¼')">ğŸ ç¾©å¼ç‰›æ’</div>
        <div class="tag" onclick="tog(this, 'é€Ÿé£Ÿ')">ğŸ” ç‚¸é›é€Ÿé£Ÿ</div>
        <div class="tag" onclick="tog(this, 'é£²æ–™')">ğŸ¥¤ é£²æ–™ç”œé»</div>
      </div>

      <button class="btn-main" onclick="startShow()">ğŸ© è®Šè®Šè®Šï¼(æœå°‹)</button>
      <button class="btn-main btn-outline" onclick="go(2)">â†© ä¸Šä¸€æ­¥</button>
    </div>

    <div id="scene4" class="scene">
      <div class="host-area">
        <div class="host-avatar" id="av4"></div>
        <div class="bubble" id="res-msg">ç™»æ„£ï¼åœ˜é•·æ¨è–¦é€™å¹¾å®¶ âœ¨</div>
      </div>
      <div id="ticket-box"></div>
      <div style="display:flex; gap:10px; margin-top:20px;">
        <button class="btn-main btn-outline" onclick="resetAll()" style="flex:1; font-size:0.9rem;">ğŸ  å›å®¶</button>
        <button class="btn-main" onclick="encore()" style="flex:1.5;">ğŸª å®‰å¯ (å†æŠ½)</button>
      </div>
    </div>

    <div id="scene-empty" class="scene">
      <div class="empty-card">
        <img src="image_cf8956.jpg" style="width:80%; border-radius:15px; box-shadow:0 4px 12px rgba(0,0,0,0.15);">
        <h3 style="color:var(--text); margin-top:20px; margin-bottom:5px;">åœ˜é•·ç¿»éäº†å¸½å­...ğŸ©ğŸ’¦</h3>
        <p style="color:#888; font-size:0.9rem; line-height:1.6;">
          é‚„æ˜¯æ‰¾ä¸åˆ°ç¬¦åˆçš„åº—è€¶ã€‚<br>
          å¯èƒ½æ˜¯<b>æ™‚é–“å¤ªæ™š</b>ï¼Œæˆ–æ˜¯<b>æ¢ä»¶é¸å¤ªå¤š</b>å›‰ï¼
        </p>
        <button class="btn-main" onclick="resetAll()">ğŸ”„ é‡æ–°é¸æ“‡æ¢ä»¶</button>
      </div>
    </div>

  </div>
</div>

<script>
  // V14.0 è³‡æ–™åº«
  const db = [
    // åŒ—è‹±è·¯/åŒ—å‹¢æ±è·¯ æ“´å……å€
    {n:"Mr.38 å’–å“©ç•Œå‚³å¥‡",t:"æ—¥å¼",p:2,l:[11,21.5],d:[11,21.5],c:[],g:"ç¶“å…¸å’–å“©",lat:24.2260,lng:120.5770},
    {n:"åå‹åµ(ç†Ÿæˆå’–å“©)",t:"æ—¥å¼",p:1,l:[11,14],d:[17,20.5],c:[],g:"å­¸ç”Ÿæ„›åº—",lat:24.2262,lng:120.5770},
    {n:"åˆå·é£Ÿå ‚",t:"æ—¥å¼",p:1,l:[11.5,13.5],d:[17,20.5],c:[],g:"æ—¥å¼ä¸¼é£¯",lat:24.2265,lng:120.5760},
    {n:"éºµå®¶å®‡å‘³",t:"æ—¥å¼",p:1,l:[11.5,14],d:[17,21],c:[2],g:"æ—¥å¼æ‹‰éºµ",lat:24.2258,lng:120.5760},
    {n:"é£¯é£¯(æ²™é¹¿åº—)",t:"é£¯é¡",p:1,l:[11,13.5],d:[17,20.5],c:[],g:"ç‡’è‚‰é£¯",lat:24.2268,lng:120.5772},
    {n:"åˆäº­æ³¡èœé‹",t:"ç«é‹",p:1,l:[12,22],d:[12,22],c:[],g:"æ–™å¤šå¯¦åœ¨",lat:24.2265,lng:120.5760},
    {n:"é€™ä¸€å°é‹",t:"ç«é‹",p:2,l:[11.5,22],d:[11.5,22],c:[],g:"å¾©å¤é¢¨",lat:24.2270,lng:120.5765},

    // é£¯é¡
    {n:"æ­¡æ­¡é›è‚‰é£¯",t:"é£¯é¡",p:1,l:[10.5,13.5],d:[16.5,19.5],c:[0],g:"åœ¨åœ°ååº—",lat:24.2355,lng:120.5645},
    {n:"é¦™æ¸¯å¼·è¨˜ç‡’è‡˜",t:"é£¯é¡",p:1,l:[10.5,14],d:[16.5,20],c:[0],g:"æ’éšŠä¾¿ç•¶",lat:24.2255,lng:120.5760},
    {n:"å˜‰æ§è‚‰é£¯",t:"é£¯é¡",p:1,l:[11,20],d:[11,20],c:[0],g:"åœ¨åœ°å¼·åº—",lat:24.2270,lng:120.5730},
    {n:"é˜¿ç«ç…éµè‚‰",t:"é£¯é¡",p:2,l:[11,21],d:[11,21],c:[],g:"ååº—",lat:24.2240,lng:120.5760},
    {n:"åŒ—æ¸¯ç„¢è‚‰é£¯",t:"é£¯é¡",p:1,l:[11,20],d:[11,20],c:[],g:"è€åº—",lat:24.2355,lng:120.5645},
    {n:"å¤ªåŸçƒ¤è‚‰é£¯",t:"é£¯é¡",p:1,l:[10.5,13.5],d:[16.5,19.5],c:[0],g:"åœ¨åœ°",lat:24.2260,lng:120.5775},
    {n:"é´»é–€é´¨è‚‰é£¯",t:"é£¯é¡",p:1,l:[11,23],d:[11,23],c:[],g:"é´¨è‚‰",lat:24.2345,lng:120.5665},
    {n:"å‘¨å¸«å‚…ç‡’è‚‰é£¯",t:"é£¯é¡",p:1,l:[10.5,14],d:[16.5,20],c:[],g:"åœ¨åœ°",lat:24.2245,lng:120.5760},
    {n:"æ‚Ÿé¥•æ± ä¸Šé£¯åŒ…",t:"é£¯é¡",p:1,l:[10.5,13.5],d:[16.5,19.5],c:[0],g:"é€£é–",lat:24.2268,lng:120.5742},
    {n:"æ¢ç¤¾æ¼¢æ’éª¨",t:"é£¯é¡",p:2,l:[10.5,20.5],d:[10.5,20.5],c:[],g:"é€£é–",lat:24.2270,lng:120.5750},
    {n:"æ­£å¿ æ’éª¨é£¯",t:"é£¯é¡",p:1,l:[10.5,20],d:[10.5,20],c:[],g:"é€£é–",lat:24.2360,lng:120.5640},
    {n:"æ§è‚‰è© ",t:"é£¯é¡",p:1,l:[17,24],d:[17,24],c:[],g:"å®µå¤œ",lat:24.2260,lng:120.5765},

    // æ—©é¤
    {n:"çš‡ä½³æ‰‹ä½œè”¥æ²¹é¤…",t:"æ—©é¤",p:1,l:[6,10.5],d:[15,19],c:[0],g:"åœ¨åœ°æ¨",lat:24.2265,lng:120.5745},
    {n:"æ²™é¹¿å¸‚å ´ç„¡åæ°´ç…åŒ…",t:"æ—©é¤",p:1,l:[6,10],d:null,c:[],g:"ç§’æ®ºè€æ”¤",lat:24.2355,lng:120.5635},
    {n:"ç´ é£Ÿæ°´ç…åŒ…(ä¸‰è§’å…¬åœ’)",t:"æ—©é¤",p:1,l:[6,10],d:null,c:[],g:"åœ¨åœ°",lat:24.2360,lng:120.5640},
    {n:"é˜¿æ°´é£¯ç³°",t:"æ—©é¤",p:1,l:[6,10],d:null,c:[],g:"æ’éšŠååº—",lat:24.2360,lng:120.5630},
    {n:"æ­£è€ç‰Œéºµç·šç³Š",t:"æ—©é¤",p:1,l:[6,12.5],d:null,c:[],g:"è€åº—",lat:24.2355,lng:120.5620},
    {n:"æ²™é¹¿ç‡’é¤…",t:"æ—©é¤",p:1,l:[6,11],d:null,c:[],g:"ç‡’é¤…é³³æ¢¨é…¥",lat:24.2350,lng:120.5640},
    {n:"å±±é ‚å›ä»”æ¹¯åŒ…",t:"æ—©é¤",p:1,l:[5,13],d:null,c:[],g:"çš®è–„æ±å¤š",lat:24.2260,lng:120.5760},
    {n:"æ—©å®‰å…¬é›è¾²å ´æ™¨é£Ÿ",t:"æ—©é¤",p:1,l:[6,13.5],d:null,c:[],g:"è€éºµå ¡",lat:24.2260,lng:120.5750},
    {n:"è«å°¼æ—©é¤Morni",t:"æ—©é¤",p:1,l:[6,14],d:null,c:[],g:"é€£é–",lat:24.2280,lng:120.5760},
    {n:"åå¸ç”·",t:"æ—©é¤",p:1,l:[6.5,13.5],d:null,c:[],g:"éŸ“ç³»ç›’å­",lat:24.2265,lng:120.5770},
    {n:"å°å°è¿·è·¯",t:"æ—©é¤",p:2,l:[9,15],d:null,c:[2],g:"è³ªæ„Ÿ",lat:24.2320,lng:120.5665},
    {n:"é™³é£Ÿç©ºé–“",t:"æ—©é¤",p:2,l:[11,14.5],d:null,c:[2],g:"æ–‡é’",lat:24.2315,lng:120.5670},
    {n:"å¼˜çˆºæ¼¢å ¡(è‹±æ‰)",t:"æ—©é¤",p:1,l:[5.5,13.5],d:null,c:[],g:"é€£é–",lat:24.2240,lng:120.5780},
    {n:"éº¥å‘³ç™»(åŒ—å‹¢)",t:"æ—©é¤",p:1,l:[6,14],d:null,c:[],g:"é€£é–",lat:24.2260,lng:120.5770},
    {n:"é˜¿ä¸¹è‚‰ç‡¥é£¯",t:"æ—©é¤",p:1,l:[6,14],d:null,c:[],g:"å°å¼",lat:24.2250,lng:120.5745},

    // å°åƒ/éºµé£Ÿ
    {n:"å¯¬è‚²é¤åŠç”Ÿç‚’é´¨è‚‰ç¾¹",t:"å°åƒ",p:1,l:[10.5,14],d:[16.5,20],c:[6],g:"åœ¨åœ°æ¨",lat:24.2258,lng:120.5750},
    {n:"é †å£é¦™éº¥ä»”ç…",t:"å°åƒ",p:1,l:[9,18],d:[9,18],c:[],g:"å¸‚å ´è€æ”¤",lat:24.2355,lng:120.5640},
    {n:"é˜¿è²´å¤§è…¸éºµç·š",t:"å°åƒ",p:1,l:[7,19],d:[7,19],c:[],g:"è€åº—",lat:24.2360,lng:120.5635},
    {n:"æ‰¿è¨˜å»£æ±ç²¥",t:"å°åƒ",p:1,l:[10,22],d:[10,22],c:[6],g:"è€åº—",lat:24.2260,lng:120.5760},
    {n:"æ²™é¹¿æ‹‰ä»”éºµ",t:"å°åƒ",p:1,l:[11,19.5],d:[11,19.5],c:[],g:"æœˆè¦‹è±¬æ²¹",lat:24.2370,lng:120.5640},
    {n:"éºµåŒ¡åŒ¡é¹¹é…¥é›æ‹‰éºµ",t:"éºµé£Ÿ",p:1,l:[11,14],d:[17,23],c:[],g:"åœ¨åœ°æ¨",lat:24.2260,lng:120.5760},
    {n:"è˜‡æ­å°é¤¨",t:"éºµé£Ÿ",p:2,l:[11,14],d:[17,20.5],c:[1],g:"æ¹¯åŒ…ååº—",lat:24.2275,lng:120.5735},
    {n:"å¤§é ­éºµåº—",t:"éºµé£Ÿ",p:1,l:[11,14],d:[16.5,20],c:[0],g:"åœ¨åœ°",lat:24.2250,lng:120.5740},
    {n:"æ±Ÿè˜‡ç‰›è‚‰éºµ",t:"éºµé£Ÿ",p:2,l:[11,14],d:[17,20],c:[1],g:"åœ¨åœ°",lat:24.2255,lng:120.5780},
    {n:"æ¸…æ°´æ’éª¨éºµ(æ²™ç”°)",t:"éºµé£Ÿ",p:1,l:[10.5,20.5],d:[10.5,20.5],c:[],g:"ååº—",lat:24.2350,lng:120.5650},
    {n:"æ²™é¹¿ä¸€æ¢é¾é¤ƒé¤¨",t:"éºµé£Ÿ",p:1,l:[11,14],d:[17,21],c:[],g:"è€åº—",lat:24.2355,lng:120.5645},
    {n:"å»Ÿå£æ„éºµ",t:"éºµé£Ÿ",p:1,l:[16,23],d:[16,23],c:[],g:"è€åº—",lat:24.2350,lng:120.5620},
    {n:"é´¨è‚‰æ·»",t:"å°åƒ",p:1,l:[16,23],d:[16,23],c:[],g:"å®µå¤œ",lat:24.2355,lng:120.5630},
    {n:"é¦™é‡éŠ·é­‚éºµ",t:"éºµé£Ÿ",p:1,l:[11.5,14],d:[17,21],c:[4],g:"ç‰¹è‰²",lat:24.2265,lng:120.5740},

    // è³ªæ„Ÿç«é‹
    {n:"å®‡è‰¯é£Ÿå¥åº·é‹ç‰©",t:"ç«é‹",p:2,l:[11,22],d:[11,22],c:[],g:"æŒ‡æ¨™ååº—",lat:24.2330,lng:120.5650},
    {n:"å°šçŸ³è‹‘çŸ³é ­ç«é‹",t:"ç«é‹",p:2,l:[11,22],d:[11,22],c:[],g:"æµ·ç·šæ¨",lat:24.2315,lng:120.5750},
    {n:"åäºŒæ®µé‹ç‰©å ‚",t:"ç«é‹",p:2,l:[11,24],d:[11,24],c:[],g:"å¤§æ°£",lat:24.2350,lng:120.5640},
    {n:"ä¹…é•çŸ³é ­ç«é‹",t:"ç«é‹",p:2,l:[11.5,22],d:[11.5,22],c:[],g:"å¾©å¤é¢¨",lat:24.2360,lng:120.5660},
    {n:"çµ•å“ç«é‹",t:"ç«é‹",p:2,l:[11.5,22.5],d:[11.5,22.5],c:[],g:"æµ·é®®å¼·",lat:24.2340,lng:120.5670},
    {n:"åƒæ³¢è‹‘é‹ã®ç‰©",t:"ç«é‹",p:2,l:[11,23],d:[11,23],c:[],g:"ç¾æ’ˆæµ·é®®",lat:24.2355,lng:120.5630},
    {n:"ç¯‰é–“å¹¸ç¦é‹ç‰©(åŒ—å‹¢)",t:"ç«é‹",p:2,l:[11,28],d:[11,28],c:[],g:"é€£é–",lat:24.2280,lng:120.5760},
    {n:"è‚‰é®®ç”ŸéŸ“å¼çƒ¤è‚‰é‹",t:"ç«é‹",p:2,l:[11,22.5],d:[11,22.5],c:[],g:"åƒåˆ°é£½",lat:24.2340,lng:120.5670},
    {n:"å°šç‰›äºŒé¤¨",t:"ç«é‹",p:2,l:[17,2],d:[17,2],c:[1],g:"æº«é«”ç‰›",lat:24.2300,lng:120.5700},
    {n:"è¦“é‹ç‰©",t:"ç«é‹",p:2,l:[11.5,21],d:[11.5,21],c:[],g:"æ£®æ—ç³»",lat:24.2320,lng:120.5690},

    // æ±å—äº
    {n:"DCè¶Šå—æ–™ç†",t:"æ±å—äº",p:1,l:[10,14],d:[16,21],c:[1],g:"åœ¨åœ°æ¨",lat:24.2230,lng:120.5770},
    {n:"å§å¦¹è¶Šå—ç¾é£Ÿ",t:"æ±å—äº",p:1,l:[10,20],d:[10,20],c:[],g:"åœ¨åœ°",lat:24.2360,lng:120.5645},
    {n:"è¶Šå—æ³•åœ‹éºµåŒ…å·¥è—",t:"æ±å—äº",p:1,l:[7,19],d:[7,19],c:[1],g:"æ’éšŠ",lat:24.2345,lng:120.5640},
    {n:"Pandanæ³°å¼é¤é¤¨",t:"æ±å—äº",p:2,l:[11.5,14.5],d:[17.5,21],c:[1],g:"è³ªæ„Ÿæ³°å¼",lat:24.2280,lng:120.5740},
    {n:"é˜¿æœçš‡å®¶æ³°å¼æ–™ç†",t:"æ±å—äº",p:2,l:[11,14.5],d:[17,22],c:[1],g:"é«˜ç´šæ³°å¼",lat:24.2310,lng:120.5725},
    {n:"æ³°å¥½å‘³",t:"æ±å—äº",p:1,l:[11,14],d:[17,21],c:[2],g:"å¹³åƒ¹",lat:24.2250,lng:120.5750},
    {n:"Viet House",t:"æ±å—äº",p:1,l:[10.5,21],d:[10.5,21],c:[],g:"åœ¨åœ°",lat:24.2330,lng:120.5700},

    // ç•°åœ‹
    {n:"ä¿æ­£è»’",t:"æ—¥å¼",p:2,l:[11,14],d:[17,20.5],c:[1],g:"æ—¥å¼æ‹‰éºµ",lat:24.2255,lng:120.5745},
    {n:"å¿è€…å£½å¸",t:"æ—¥å¼",p:2,l:[11.5,14],d:[17,21],c:[2],g:"åœ¨åœ°",lat:24.2260,lng:120.5735},
    {n:"é€™ä¸€åˆ»å®šé£Ÿ",t:"æ—¥å¼",p:2,l:[11,14],d:[17,20.5],c:[],g:"åœ¨åœ°",lat:24.2330,lng:120.5660},
    {n:"æ¨¹å¤ªè€",t:"æ—¥å¼",p:2,l:[11,21],d:[11,21],c:[],g:"é€£é–",lat:24.2370,lng:120.5690},
    {n:"çˆ­é®®è¿´è½‰å£½å¸",t:"æ—¥å¼",p:2,l:[11,21.5],d:[11,21.5],c:[],g:"é€£é–",lat:24.2380,lng:120.5700},
    {n:"å’šè±¬å’šè±¬",t:"éŸ“å¼",p:2,l:[11,15.5],d:[17,22],c:[],g:"åƒåˆ°é£½",lat:24.2360,lng:120.5650},
    {n:"ç‘ªè¥¿æ‰€éŸ“å¼æ–™ç†",t:"éŸ“å¼",p:1,l:[11,14],d:[17,21],c:[1],g:"åœ¨åœ°",lat:24.2252,lng:120.5770},
    {n:"é‡œå±±å´”ç‚¸é›",t:"éŸ“å¼",p:1,l:[11.5,14],d:[17,22],c:[0],g:"é€£é–",lat:24.2258,lng:120.5765},
    {n:"NU PASTA",t:"è¥¿å¼",p:2,l:[11,21],d:[11,21],c:[],g:"é€£é–",lat:24.2265,lng:120.5768},
    {n:"å‚‘ç†æ­æ³•å°é¤¨",t:"è¥¿å¼",p:2,l:[11.5,14],d:[17.5,21],c:[1],g:"è³ªæ„Ÿ",lat:24.2270,lng:120.5750},
    {n:"æŠ«è–©å·¥å» ",t:"è¥¿å¼",p:2,l:[11.5,15],d:[17,21.5],c:[],g:"åœ¨åœ°",lat:24.2278,lng:120.5752},

    // é£²æ–™/é»å¿ƒ/å®µå¤œ
    {n:"è¯å¾—ä¾†(æ²™ç”°)",t:"é£²æ–™",p:1,l:[9,21],d:[9,21],c:[],g:"å¿…å–",lat:24.2365,lng:120.5650},
    {n:"é˜¿ç¾©é³³æ¢¨å†°",t:"é£²æ–™",p:1,l:[10,22],d:[10,22],c:[],g:"åœ¨åœ°",lat:24.2350,lng:120.5640},
    {n:"è±†ç²¹è±†èŠ±åŠ",t:"é£²æ–™",p:1,l:[10.5,22],d:[10.5,22],c:[5],g:"åœ¨åœ°",lat:24.2365,lng:120.5640},
    {n:"è‰¾æ–¯é…·æ¯”",t:"é£²æ–™",p:1,l:[12,21],d:[12,21],c:[],g:"å†°å“",lat:24.2260,lng:120.5780},
    {n:"50åµ",t:"é£²æ–™",p:1,l:[10,22],d:[10,22],c:[],g:"é€£é–",lat:24.2265,lng:120.5745},
    {n:"å¾—æ­£ Oolong",t:"é£²æ–™",p:1,l:[10,21],d:[10,21],c:[],g:"ç†±é–€",lat:24.2265,lng:120.5760},
    {n:"å…«æ›œå’ŒèŒ¶",t:"é£²æ–™",p:1,l:[10,22],d:[10,22],c:[],g:"ç†±é–€",lat:24.2260,lng:120.5750},
    {n:"èƒ–è€çˆ¹ç¾å¼ç‚¸é›",t:"é€Ÿé£Ÿ",p:1,l:[15,23],d:[15,23],c:[1],g:"é€£é–",lat:24.2235,lng:120.5770},
    {n:"é–‹æºç¤¾é¦™é›æ’",t:"é€Ÿé£Ÿ",p:1,l:[15,24],d:[15,24],c:[],g:"åˆ·é†¬",lat:24.2255,lng:120.5760},
    {n:"ç‹€å…ƒé¦™æ»·å‘³",t:"å®µå¤œ",p:1,l:[16,24],d:[16,24],c:[],g:"å†·æ»·",lat:24.2265,lng:120.5755},
    {n:"å°±é†¬å­çƒ¤å§",t:"å®µå¤œ",p:2,l:[17.5,25],d:[17.5,25],c:[],g:"ä¸²ç‡’",lat:24.2270,lng:120.5750},
    {n:"è·¯é‚Šçƒ¤è‚‰WildBBQ",t:"å®µå¤œ",p:2,l:[17,24],d:[17,24],c:[],g:"è³ªæ„Ÿä¸²ç‡’",lat:24.2330,lng:120.5680},
    {n:"åˆå®¶ç¢³çƒ¤ç‡’æ¤’é¤…",t:"å°åƒ",p:1,l:[13,18],d:[13,18],c:[],g:"é»å¿ƒ",lat:24.2358,lng:120.5642},
    {n:"ç›§ã®å ¡(è„†çš®ç”œç”œåœˆ)",t:"é£²æ–™",p:1,l:[14,19],d:[14,19],c:[],g:"åŠæœˆç‡’",lat:24.2260,lng:120.5760}
  ];

  // --- æ ¸å¿ƒé‚è¼¯ ---
  const C = { lat: 24.2320, lng: 120.5680 };
  let user = { m:'', p:0, t:[] };
  let pool = [];
  let shownCount = 0;
  const avatars = ['image_cf8613.jpg', 'image_cf8619.jpg', 'image_cf8956.jpg'];

  // å®‰å…¨å•Ÿå‹•ï¼šå¼·åˆ¶é¡¯ç¤ºç¬¬ä¸€é ï¼Œé˜²æ­¢ç©ºç™½
  window.onload = function() {
    go(1);
  };

  function go(n) {
    // éš±è—æ‰€æœ‰é é¢
    document.querySelectorAll('.scene').forEach(e => e.classList.remove('active'));
    
    // ä¿®æ­£ ID å‘½åï¼šå¦‚æœå‚³å…¥ '-empty' å‰‡æ‰¾ 'scene-empty'ï¼Œå¦å‰‡æ‰¾ 'scene'+n
    let targetId = (n === '-empty') ? 'scene-empty' : 'scene' + n;
    let target = document.getElementById(targetId);
    
    if (target) {
      target.classList.add('active');
      // æ›é ­åƒ
      const rand = avatars[Math.floor(Math.random() * avatars.length)];
      document.querySelectorAll('.host-avatar').forEach(a => a.style.backgroundImage = `url('${rand}')`);
    } else {
      console.error("æ‰¾ä¸åˆ°é é¢: " + targetId);
      // å¦‚æœå‡ºéŒ¯ï¼Œå¼·åˆ¶å›é¦–é 
      document.getElementById('scene1').classList.add('active');
    }
  }

  function setMeal(m) { user.m = m; setTimeout(() => go(2), 200); }
  function setPrice(p) { user.p = p; setTimeout(() => go(3), 200); }
  function tog(el, type) {
    el.classList.toggle('active');
    if(user.t.includes(type)) user.t = user.t.filter(x => x !== type);
    else user.t.push(type);
  }

  function checkTime(s) {
    const now = new Date();
    const h = now.getHours();
    const m = now.getMinutes();
    const t = h + m/60;
    const d = now.getDay();

    if (s.c.includes(d)) return {k:'lamp-off', v:'ä»Šæ—¥å…¬ä¼‘'};

    let range;
    if(user.m === 'b') range = s.l && s.l[0] < 10 ? s.l : null;
    else if(user.m === 'l') range = s.l;
    else if(user.m === 'd') range = s.d;
    else range = s.d && s.d[1] > 21 ? s.d : null;

    if(!range) return {k:'lamp-off', v:'éç‡Ÿæ¥­æ™‚æ®µ'};

    if (t >= range[0] && t < range[1]) return {k:'lamp-on', v:'ç‡Ÿæ¥­ä¸­'};
    if (t < range[0]) {
      const wait = Math.floor((range[0]-t)*60);
      const hr = Math.floor(wait/60);
      const min = wait%60;
      return {k:'lamp-wait', v:`å†${hr>0?hr+'æ™‚':''}${min}åˆ†é–‹`};
    }
    return {k:'lamp-off', v:'å·²æ‰“çƒŠ'};
  }

  function getDist(lat, lng) {
    const R = 6371e3;
    const rad = Math.PI/180;
    const dLat = (lat - C.lat)*rad;
    const dLng = (lng - C.lng)*rad;
    const a = Math.sin(dLat/2)**2 + Math.cos(C.lat*rad)*Math.cos(lat*rad)*Math.sin(dLng/2)**2;
    return Math.round(R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
  }

  function startShow() {
    if(user.t.length === 0) { alert("åœ˜é•·æé†’ï¼šè«‹è‡³å°‘é¸ä¸€å€‹é¡å‹å–”ï¼"); return; }
    
    pool = db.filter(s => {
      if(!user.t.includes(s.t)) return false;
      if(user.p !== 0 && s.p !== user.p) return false;
      if(user.m === 'b' && (!s.l || s.l[0] > 10)) return false;
      if(user.m === 'n' && (!s.d || s.d[1] < 21)) return false;
      return true;
    });

    pool.sort(() => Math.random() - 0.5);
    shownCount = 0;

    if(pool.length === 0) {
      go('-empty');
    } else {
      go(4);
      renderResults();
    }
  }

  function encore() {
    renderResults();
  }

  function renderResults() {
    const box = document.getElementById('ticket-box');
    const msg = document.getElementById('res-msg');
    box.innerHTML = '';

    if(shownCount >= pool.length) {
      if(confirm("æ‰€æœ‰åå–®éƒ½çœ‹éä¸€è¼ªå›‰ï¼è¦é‡æ–°æ´—ç‰Œå†ä¾†ä¸€æ¬¡å—ï¼Ÿ")) {
        pool.sort(() => Math.random() - 0.5);
        shownCount = 0;
      } else { return; }
    }

    const batch = pool.slice(shownCount, shownCount + 3);
    shownCount += batch.length;

    msg.innerHTML = `ç™»æ„£ï¼åœ˜é•·æ¨è–¦é€™ <b>${batch.length}</b> å®¶ âœ¨<br>(å£è¢‹è£¡é‚„æœ‰ ${pool.length - shownCount} å€‹é¸æ“‡)`;

    batch.forEach(s => {
      const st = checkTime(s);
      const dist = getDist(s.lat, s.lng);
      const walk = Math.ceil(dist/66);
      const ride = Math.ceil(dist/333);

      const html = `
        <div class="ticket">
          <div class="status-lamp ${st.k}">${st.v}</div>
          <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.n + " æ²™é¹¿")}" target="_blank" class="shop-n">${s.n} â†—</a>
          <div class="meta-row">
            <span class="badge ${s.g==='é€£é–'?'b-chain':(s.g==='åœ¨åœ°æ¨'?'b-hot':'b-local')}">${s.g}</span>
            <span style="font-size:0.75rem;color:#888;">${s.t} Â· ${s.p===1?'$å¹³åƒ¹':'$$è³ªæ„Ÿ'}</span>
          </div>
          <div class="dist-info">
            <span>ğŸ“ ${dist}m</span>
            <span>ğŸš¶ ${walk}åˆ†</span>
            <span>ğŸ›µ ${ride}åˆ†</span>
          </div>
        </div>
      `;
      box.innerHTML += html;
    });
  }

  function resetAll() {
    user = { m:'', p:0, t:[] };
    document.querySelectorAll('.card-btn').forEach(c => c.classList.remove('selected'));
    document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
    go(1);
  }
</script>

</body>
</html>